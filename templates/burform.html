<!-- templates/burform.html -->
<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="utf-8">
    <title>Форма буровика</title>
    <link rel="stylesheet" href="/static/style.css">
    <style>
      .small { font-size: 0.9rem; color: #666; }
      .row { margin-top: 10px; }
    </style>
</head>
<body>
  <div class="container">
    <h2>Сводка буровика</h2>

    {% if request.query_params.get("ok") %}
      <p style="color:green;">Сводка отправлена успешно</p>
    {% elif request.query_params.get("fail") %}
      <p style="color:red;">Ошибка при отправке сводки</p>
    {% endif %}

    <form action="/submit_report" method="post">
      <div class="row">
        <label>Дата / Время (UTC)</label>
        <input type="text" name="created_at_display" value="{{ (now()|default(None)) }}" readonly
               id="dt" />
      </div>

      <div class="row">
        <label>Участок</label>
        <select name="section" required>
          <option value="">-- выберите участок --</option>
          {% for s in sections %}
            <option value="{{ s }}" {% if user.section == s %}selected{% endif %}>{{ s }}</option>
          {% endfor %}
        </select>
      </div>

      <div class="row">
        <label>Номер буровой установки (агрегат)</label>
        <input type="text" name="bur_no" value="{{ user.username }}" readonly>
      </div>

      <div class="row">
        <label>Метраж</label>
        <input type="number" step="0.1" name="footage" required>
      </div>

      <div class="row">
        <label>Погонометр</label>
        <input type="number" step="0.1" name="pogonometr" required>
      </div>

      <div class="row">
        <label>Тип операции</label>
        <input type="text" name="operation_type" required>
      </div>

      <div class="row">
        <label>Операция (описание)</label>
        <input type="text" name="operation" required>
      </div>

      <div class="row">
        <label>Ответственное лицо (буровик)</label>
        <input type="text" name="bur_display" value="{{ user.full_name }}" readonly>
      </div>

      <div class="row">
        <label>Примечание</label>
        <textarea name="note"></textarea>
      </div>

      <div class="row">
        <button type="submit">Отправить</button>
      </div>
    </form>

    <br>
    <a href="/logout">Выйти</a>
  </div>

  <script>
    // set local visible datetime field (UTC)
    document.addEventListener("DOMContentLoaded", function(){
      const dt = new Date();
      const iso = dt.toISOString().replace('T',' ').split('.')[0] + ' UTC';
      const el = document.getElementById('dt');
      if(el) el.value = iso;
    });
  </script>
</body>
</html>
