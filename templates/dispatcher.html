<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <title>–°–≤–æ–¥–∫–∏ –±—É—Ä–æ–≤–∏–∫–æ–≤</title>
    <style>
        body { font-family: Arial; background: #f4f4f4; margin: 0; padding: 20px; }
        table { border-collapse: collapse; width: 100%; background: white; }
        th, td { border: 1px solid #ccc; padding: 8px; text-align: center; }
        th { background: #007bff; color: white; }
        button, a { display: inline-block; margin: 10px 5px; padding: 8px 12px; text-decoration: none; border-radius: 5px; cursor: pointer; }
        .excel { background: green; color: white; }
        .users { background: orange; color: white; }
        .logout { background: red; color: white; }
        #userModal { display:none; position:fixed; top:0; left:0; width:100%; height:100%; background:rgba(0,0,0,0.5); }
        #modalContent { background:white; margin:10% auto; padding:20px; width:300px; border-radius:10px; }
    </style>
</head>
<body>
<h2>–°–≤–æ–¥–∫–∏ –±—É—Ä–æ–≤–∏–∫–æ–≤</h2>
<a class="excel" href="/export_excel">üìä –≠–∫—Å–ø–æ—Ä—Ç –≤ Excel</a>
<button class="users" onclick="openUserModal()">üë§ –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏</button>
<a class="logout" href="/logout">üö™ –í—ã—Ö–æ–¥</a>

<table>
    <tr>
        <th>ID</th><th>–î–∞—Ç–∞ –∏ –≤—Ä–µ–º—è</th><th>–£—á–∞—Å—Ç–æ–∫</th><th>–ù–æ–º–µ—Ä –±—É—Ä–æ–≤–æ–π</th><th>–ú–µ—Ç—Ä–∞–∂</th><th>–ü–æ–≥–æ–Ω–æ–º–µ—Ç—Ä</th><th>–ü—Ä–∏–º–µ—á–∞–Ω–∏–µ</th><th>–û—Ç–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω–æ–µ –ª–∏—Ü–æ</th>
    </tr>
    {% for r in reports %}
    <tr>
        <td>{{ r.id }}</td>
        <td>{{ r.date_time }}</td>
        <td>{{ r.location }}</td>
        <td>{{ r.rig_number }}</td>
        <td>{{ r.meterage }}</td>
        <td>{{ r.pogon }}</td>
        <td>{{ r.note }}</td>
        <td>{{ r.operator_name }}</td>
    </tr>
    {% endfor %}
</table>

<div id="userModal">
    <div id="modalContent">
        <h3>–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º–∏</h3>
        <form id="addUserForm">
            <input type="text" name="username" placeholder="–õ–æ–≥–∏–Ω" required><br><br>
            <input type="password" name="password" placeholder="–ü–∞—Ä–æ–ª—å" required><br><br>
            <input type="text" name="full_name" placeholder="–§–ò–û" required><br><br>
            <button type="submit">–î–æ–±–∞–≤–∏—Ç—å</button>
        </form>
        <hr>
        <form id="deleteUserForm">
            <input type="text" name="username" placeholder="–õ–æ–≥–∏–Ω –¥–ª—è —É–¥–∞–ª–µ–Ω–∏—è" required><br><br>
            <button type="submit">–£–¥–∞–ª–∏—Ç—å</button>
        </form>
        <br>
        <button onclick="closeUserModal()">–ó–∞–∫—Ä—ã—Ç—å</button>
    </div>
</div>

<script>
function openUserModal() { document.getElementById('userModal').style.display='block'; }
function closeUserModal() { document.getElementById('userModal').style.display='none'; }

document.getElementById('addUserForm').onsubmit = async (e) => {
    e.preventDefault();
    const formData = new FormData(e.target);
    const res = await fetch('/add_user', { method:'POST', body: formData });
    const data = await res.json();
    alert(data.message || data.error);
};

document.getElementById('deleteUserForm').onsubmit = async (e) => {
    e.preventDefault();
    const formData = new FormData(e.target);
    const res = await fetch('/delete_user', { method:'POST', body: formData });
    const data = await res.json();
    alert(data.message || data.error);
};
</script>
</body>
</html>
